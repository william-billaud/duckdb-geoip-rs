# name: test/sql/rusty_quack.test
# description: test rusty_quack extension
# group: [geoip-rs]

# Before we load the extension, this will fail
statement error
SELECT rusty_quack('Sam');
----
Catalog Error: Scalar Function with name rusty_quack does not exist!

# Require statement will ensure the extension is loaded from now on
require duckdb_geoip_rs

require icu

# Confirm the extension works (ASN)
# Use maxmindb test db, fromm test_db directory
query TT
SELECT geoip_asn_org('83.206.12.5'), geoip_asn_num('83.206.12.5');
----
France Telecom - Orange
3215

# Confirm the extension works (City)
query TT
SELECT geoip_country_iso('2.125.160.217'),geoip_city('2.125.160.217');
----
GB
Boxford


# Confirm the extension works (ASN) /IPV6
query TT
SELECT geoip_asn_org('2a01:c000::fade'), geoip_asn_num('2a01:c000::fade');
----
Orange S.A.
5511

# Confirm the extension works (City/IPv6)
query TT
SELECT geoip_country_iso('2a02:da40::6'),geoip_city('2a02:da40::6');
----
GB
(empty)

# Confirm empty result on non ip query
query TTTT
SELECT geoip_asn_org('not_an_ip'),geoip_asn_num('not_an_ip'), geoip_city('not_an_ip'),geoip_country_iso('not_an_ip');
----
(empty)
(empty)
(empty)
(empty)
